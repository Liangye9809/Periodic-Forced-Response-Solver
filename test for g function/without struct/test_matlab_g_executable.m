
N = 2^8;
Nx = 4;
xtest = rand(N, 3 * Nx);
kn = [3.975884068743114e+06;3.975884068743114e+06;3.975884068743114e+06;3.975884068743114e+06];
xn0 = [0;0;0;0];
mu = [0.100000000000000,0.100000000000000;0.100000000000000,0.100000000000000;0.100000000000000,0.100000000000000;0.100000000000000,0.100000000000000];
kt = [3.975884068743113e+03,3.975884068743113e+03;3.975884068743113e+03,3.975884068743113e+03;3.975884068743113e+03,3.975884068743113e+03;3.975884068743113e+03,3.975884068743113e+03];
w_in = [0,0;0,0;0,0;0,0];

tic;
for i = 1:1000
    [F, w] = g(xtest, kn, xn0, mu, kt, w_in);
end
toc;
fprintf('done\n');

function [F, w] = g(xt, kn, xn0, mu, kt, w_in) % xt, each rows correspond each time, columns are different dofs

    [N, ~] = size(xt);
    x = xt';
    F = zeros(size(x));

    for j = 1:2
        for i = 1:N
            [F(:, i), w] = gf(x(:, i), kn, xn0, mu, kt, w_in);
            w_in = w; 
        end
    end
    
end
